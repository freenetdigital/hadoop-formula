{%- from 'hadoop/hive/settings.sls' import hive with context %}
{%- from 'hadoop/settings.sls' import hadoop with context %}
{%- set dyn_cfg = hive.get('config_hive_site', {}) -%}
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
<configuration>
   {%- if hadoop.secure_mode %}
   <property>
            <name>hive.server2.authentication</name>
            <value>kerberos</value>
   </property>
    <property>
            <name>hive.server2.authentication.kerberos.keytab</name>
            <value>/etc/krb5/hive.keytab</value>
   </property>
    <property>
            <name>hive.server2.authentication.kerberos.principal</name>
	    <value>hive/{{ grains['fqdn']}}@{{grains['cluster_id'] | upper }}</value>
   </property>
   {%- endif %}

    <property>
	    <name>javax.jdo.option.ConnectionUserName</name>
	    <value>{{ hive.metastore_user }}</value>
   </property>
    <property>
	    <name>javax.jdo.option.ConnectionPassword</name>
	    <value>{{ hive.metastore_pass }}</value>
   </property>

{%- for name, subdict in dyn_cfg.items() %}
    <property>
        <name>{{ name }}</name>
{%- for k,v in subdict.items() %}
        <{{k}}>{{ v }}</{{k}}>
{%- endfor %}
    </property>
{%- endfor %}
</configuration>
